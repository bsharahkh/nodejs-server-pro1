import{a as u}from"./chunk-XARGZZIY.js";import{f as p}from"./chunk-LE2T2ZCV.js";import{b as l}from"./chunk-4N62LD7P.js";import{H as o,K as h,P as n,ia as a}from"./chunk-DDVZQDE5.js";var k=(()=>{let r=class r{constructor(t,e){this.http=t,this.router=e,this.apiUrl=`${u.apiUrl}/auth`,this.tokenKey="auth_token",this.currentUser=a(null),this.loadUser()}signup(t,e){return this.http.post(`${this.apiUrl}/signup`,{email:t,password:e})}login(t,e){return this.http.post(`${this.apiUrl}/login`,{email:t,password:e}).pipe(o(s=>this.handleAuth(s)))}verifyEmail(t,e){return this.http.post(`${this.apiUrl}/verify-email`,{email:t,code:e})}resetSendCode(t){return this.http.post(`${this.apiUrl}/reset/send-code`,{email:t})}resetVerify(t,e,s){return this.http.post(`${this.apiUrl}/reset/verify`,{email:t,code:e,newPassword:s})}googleLogin(t){return this.http.post(`${this.apiUrl}/google`,{token:t}).pipe(o(e=>this.handleAuth(e)))}handleAuth(t){localStorage.setItem(this.tokenKey,t.token),this.loadUser()}loadUser(){let t=this.getToken();if(t)try{let e=JSON.parse(atob(t.split(".")[1]));this.currentUser.set({userId:e.userId,roles:e.roles||[]})}catch{this.logout()}}getToken(){return localStorage.getItem(this.tokenKey)}isAuthenticated(){return!!this.getToken()}hasRole(t){var e;return((e=this.currentUser())==null?void 0:e.roles.includes(t))||!1}logout(){localStorage.removeItem(this.tokenKey),this.currentUser.set(null),this.router.navigate(["/auth/login"])}};r.\u0275fac=function(e){return new(e||r)(n(l),n(p))},r.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();export{k as a};
